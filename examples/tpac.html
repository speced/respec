<!DOCTYPE html>
<html>
  <head>
    <title>TPAC 2019</title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class=
    'remove'></script>
    <script class='remove'>
      var respecConfig = {
        specStatus: "ED",
        shortName: "payment-request",
        editors: [{
          name: "Marcos Caceres",
        }, {
          name: "Kagami Sascha Rosylight",
        }, {
          name: "Sid Vishnoi",
        }],
        github: "https://github.com/w3c/some-API/",
        testSuiteURI: "https://w3c-test.org/some-API/",
        implementationReportURI: "https://w3c.github.io/test-results/some-API",
        mdn: true,
        format: "markdown",
        // localBiblio: {
        //   "credential-management": { aliasOf: "credential-management-1" },
        //   "css-scoping": { aliasOf: "css-scoping-1" },
        // },
        // lint: {
        //   "no-headingless-sections": false,
        // }
      };
    </script>
<body>

<section id="abstract">
  ## New stuff in ReSpec!

  ... we have been busy! üèãÔ∏è‚Äç

</section>




## Contributor and stats - Marcos

  - 37 Contributors
  - Supports numerous students - GSoC, Outreachy



## Now in two flavours - Marcos
  - üçè respec-w3c.js
    - 327Kb - (93Kb) gzip
  - üçé respec-w3c-common.js
    - includes jQuery
    - 416Kb (123Kb) gzip
  - Significant speed improvements
    (IDB caching + cache api)




## xref - Automatic references linking (Sid)

``` html
<!-- before -->
<a data-cite="URL#concept-url-parser">
  URL parser
</a>
<code>
  <a data-cite="HTML/webappapis.html#eventhandler">
    EventHandler
  </a>
</code>

<!-- after -->
<a>URL parser</a>
{{ EventHandler }}
```



### How it works?
  - https://respec.org/xref
    - HTTP API
    - Integrates CSSWG's Shepherd API using bikeshed-data
    - Links definitions exported from a spec (`data-export`)
  - ReSpec
    - Collect terms to link and along with their _contextual information_.
    - Send request to the API
    - Link terms.
    - Profit.


<!--

### How to use?

<a data-cite="URL#concept-url-parser">URL parser</a><br>
<a>URL parser</a><br>

[= URL parser =]<br>

IDL Linking Syntax<br>

<code><a data-cite="HTML/webappapis.html#eventhandler">EventHandler</a></code><br>

{{ EventHandler }}<br>

{{ EventTarget.addEventListener(type, callback) }}

-->

<!-- Use profiles
  "web-platform": ["HTML", "INFRA", "URL", "WEBIDL", "DOM", "FETCH"]
-->




### Context

contextual information?
- Which spec?
- What type: IDL (interface, attribute, ...), Concept (dfn, event, element)
- `data-dfn-for` AKA "for context"



<!--
#### spec context
<section data-cite="dom html">
  ##### section 1
  <p><a id="link1">event handler</a> try either [dom] or [html]</p>
  <section data-cite="dom">
    <p data-cite="svg">
      <a id="link2">event handler</a>
      - not in [svg] -> fallback to [dom] -> fallback to [dom], [html]
    </p>
    <p>
      If you provide a `data-cite` directly on `&lt;a>`,
      fallback won't be used: <a id="link3" data-cite="fetch">event handler</a>
    </p>
  </section>
</section>
<section data-cite="html">
  ##### section 2
  <p>
    Uses [[css-scoping]] to create context for <a id="link4">shadow root</a>
  </p>
</section>
-->




<!--
#### for context

[=set / For each=]
[= map / For each =]
[=Event/stop propagation flag=]

// event attribute of Window interface
<br>
{{ Window/event }}
<br>
{{ Window.event }}
<br>
{{ EventTarget.addEventListener(type, callback) }}
<br>
-->




#### type context

<!--
Attribute:
{{Event/srcElement}}
<br>

Exception:
{{ "NotAllowedError" }}
<br>

Enum:
{{ ReferrerPolicy / "no-referrer" }}

<p data-cite="html">
  Element: [^script^]
</p>
-->



<!--
### Aliasing

[= code point| Unicode code point =]<br>
[=set / For each | for each member =]<br>

{{ "NotAllowedError" | don't do this }}
-->




<!--
### Error messages
<p data-cite="svg2">
  Ambiguous Definition: defined in multiple specs: [^script^]
</p>
<p data-cite="html dom url">
  No such term found: [= foobar =]
</p>
<p data-cite="service-workers">
  Defined in multiple ways in a single spec: <a>request</a> (not enough
  context to understand)<br>
  [=cache batch operation/request=]<br>
  {{FetchEventInit/request}}<br>
  {{FetchEvent/request}}<br>
</p>
-->



### xref search UI

https://respec.org/xref/



## Web IDL linking - Kagami

We added several features using Web IDL parser library named
[webidl2.js](https://github.com/w3c/webidl2.js/) and the first of them is
automatic IDL linking.

<pre class="idl" data-cite="webidl html dom">
  [Exposed=Window]
  interface LinkWorksEvent: Event {
    void makeLinkWork(EventInit init);
    attribute HTMLLinkElement link;
  };
</pre>

webidl2.js detects that this IDL block has several identifiers that needs
linking, and then it uses the cross reference feature we mentioned earlier to
link them to the relevant lines of their specifications. Here we have `Event`
to DOM and `HTMLLinkElement` to HTML, and you can click them to nagivate to
their relevant specifications.

<pre class="idl" data-cite="html">
  [Exposed=Window]
  partial interface Navigator {};
</pre>

ReSpec also supports linking partial types. Here, you can click `Navigator` to
navigate to the relevant section of HTML.

## IDL self-definition - Kagami

<pre class="idl">
  [Exposed=Window]
  interface TryLinkingToMe {};
</pre>

Previously we had to provide a proper `<dfn>` element when we define any IDL
types. Now you can skip it if you are sure you don't need one and prefer
simpler document structure. We still recommends you to provide a good
explanation for your IDL types with `<dfn>` whenever possible.

```
<dfn>TryLinkingToMe</dfn> // This is now optional
<a>TryLinkingToMe</a> // Linking is now possible without <dfn>
```

## Web IDL validations - Kagami

One of the best feature frow webidl2.js is validations! It's easy to write
invalid IDL because specification authors are not always IDL experts, and the
Web IDL specification itself sometimes changes in a breaking way. The
validation feature in ReSpec helps fixing IDL when that happens.


### Duplicate identifiers

<pre class="idl">
  // No duplication!
  [Exposed=Window]
  interface Duplicated {};
  dictionary Duplicated {};
</pre>

ReSpec detects and warns there are duplicated identifiers here. You can read
the relevant error messages and the exact position of the errors when you click
the ReSpec pill. You can also click `[1]` to see where the erroneous IDL blocks
are.


### Constructor syntax

<pre class="idl">
  // Use new constructor() - can be autofixed!
  [Exposed=Window, Constructor]
  interface IHaveConstructor {
  };
</pre>

Recently Web IDL specification is changed to use new `constructor()` operation
syntax instead of previous `[Constructor]` extended attribute. Now ReSpec warns
when you use `[Constructor]`, and it also provides an automatically suggested
fix from the ReSpec pill! You can copy-paste the suggestion to fix IDLs and
voila! The error disappears.


### Implicitly exposed types

<pre class="idl">
  // Needs explicit [Exposed]
  interface ImplicitlyExposed {};
</pre>

Previously interfaces with explicit `[Exposed]` are considered as being
implicitly exposed to `Window` only. Now interfaces are required to exposed
explicitly, and thus ReSpec automatically suggests adding `[Exposed=Window]`.


### Optional dictionary argument

<pre class="idl">
  // optional dictionary argument
  // needs a default value
  dictionary MyDictionary {};
  [Exposed=Window]
  interface IUseTheDictionary {
    void doTheFoo(optional MyDictionary dict);
  };
</pre>

Similarly, ReSpec now suggest adding `= {}` because  optional dictionary
arguments are now required to have an explicit default value.


### Why just warnings, could it just fix everything for us?

* Changes should be reviewed, shouldn't be magic

   We want authors to know what's exactly happening, and also there are cases
   that authors might want to review before applying the fix. For example,
   authors might want to add `[Exposed=(Window,Worker)]` instead of just
   `[Exposed=Window]` suggested from ReSpec.

* There is [a bot](https://github.com/w3c/payment-handler/pull/343) to fix IDLs for us.

   Because copy-paste is hard! It also helps non-ReSpec specifications to get
   correct IDLs.


## Algorithms - Marcos
  - var pipe syntax
  - type annotations
  - variable highlighting

<ol class="algorithm" data-cite="infra">
  <li>Let the <var>string</var> be a DOMString.</li>
  <li>Let the fruits be a <a>list</a> of
      ¬´ "a", "b", "c" ¬ª.
  </li>
  <li>[=set/For each=] |letter:DOMString| in |set|.</li>
</ol>

## Pluralization / Singularization - Kagami

ReSpec knows `bananas` is a pluralized form of `banana`.

```
<dfn>Banana</dfn> <a data-lt="banana">bananas</a>
```

Previously we had to add `data-lt="banana"` to link `bananas` to `banana`, but
now you can just do `<a>bananas</a>` because ReSpec does it automatically.

It also works in a backward way, where `apple` automatically links to `Apples`:

```
<dfn>Apples</dfn> <a>apple</a>
```

## mdn integration - Marcos

  - config option `mdn: true`

## mdn integration - Marcos

  - config option `caniuse: "feature"`

## Support us on Open collective!


<section id="sotd" style="display: none">
... the end ...
</section>
</body>
